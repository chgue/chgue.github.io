async function bytesToBase64DataUrl(e,t="application/octet-stream"){return await new Promise((n,s)=>{const o=Object.assign(new FileReader,{onload:()=>n(o.result),onerror:()=>s(o.error)});o.readAsDataURL(new File([e],"",{type:t}))})}async function dataUrlToBytes(e){const t=await fetch(e);return new Uint8Array(await t.arrayBuffer())}function shuffledBlocks(e,t,n){if(e%n!==0||t%n!==0)throw new Error("Width and height must be multiples of blockSize!");const s=[],o=Math.floor(e/n),i=Math.floor(t/n),a=o*i;for(let e=0;e<a;e++){let n=e%o,i=Math.floor(e/o);s.push([n,i]);let t=Math.floor(Math.random()*(e+1));[s[e],s[t]]=[s[t],s[e]]}return s}function convertRGBtoRGBA(e,t=255){const n=new Uint8ClampedArray(e.length/3*4);for(let s=0,o=0;s<e.length;s+=3,o+=4)n[o]=e[s],n[o+1]=e[s+1],n[o+2]=e[s+2],n[o+3]=t;return n}async function decodeImg(e){const t=document.getElementById("picture");if(t===null)return;t.oncontextmenu=()=>!1;const s=t.getContext("2d");HTMLCanvasElement.prototype.getContext=()=>{};const o=new Uint8ClampedArray(await dataUrlToBytes(t.dataset.img)),i=convertRGBtoRGBA(o),a=new ImageData(i,t.width,t.height);s.putImageData(a,0,0);const r=new Uint8ClampedArray(await crypto.subtle.decrypt({name:"AES-CTR",counter:new Uint8Array(16),length:128},e,o)),c=convertRGBtoRGBA(r),l=new ImageData(c,t.width,t.height),n=64,d=shuffledBlocks(t.width,t.height,n);for(const[e,t]of d)x=e*n,y=t*n,s.putImageData(l,0,0,x,y,n,n),await new Promise(e=>setTimeout(e,25))}async function decodeEmail(e){const t=document.querySelectorAll(".email");for(const n of t){const o=await dataUrlToBytes(n.getAttribute("data-email")),i=new Uint8ClampedArray(await crypto.subtle.decrypt({name:"AES-CTR",counter:new Uint8Array(16),length:128},e,o)),s=(new TextDecoder).decode(i);n.innerText=s,n.href=`mailto:${s}`}}async function getKey(){hostname=(new TextEncoder).encode(window.location.hostname),padding=new Uint8Array(32);const e=new Uint8Array(hostname.length+padding.length);e.set(hostname),e.set(padding,hostname.length);const t=await crypto.subtle.importKey("raw",e.slice(0,32),{name:"AES-CTR"},!0,["encrypt","decrypt"]);return t}window.onload=async()=>{HTMLCanvasElement.prototype.toDataURL=()=>{},HTMLCanvasElement.prototype.toBlob=()=>{},HTMLCanvasElement.prototype.captureStream=()=>{};const e=await getKey();decodeEmail(e),decodeImg(e)}